<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ABIS Live - UK Intelligence v1.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: 0; }
    }
    .animate-in { animation: fadeIn 0.7s ease-out; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-slate-950 text-slate-200">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide Icons as inline SVG components
    const Shield = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
    );

    const TrendingUp = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
      </svg>
    );

    const Zap = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
      </svg>
    );

    const LayoutDashboard = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/>
      </svg>
    );

    const Database = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
      </svg>
    );

    const History = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/>
      </svg>
    );

    const Wallet = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/>
      </svg>
    );

    const Users = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    );

    const ArrowUpRight = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/>
      </svg>
    );

    const CheckCircle2 = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/>
      </svg>
    );

    const Copy = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
    );

    const Info = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
      </svg>
    );

    const Gift = ({className, size=24}) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
      </svg>
    );

    const Calculator = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14.01"/><line x1="12" y1="14" x2="12" y2="14.01"/><line x1="8" y1="14" x2="8" y2="14.01"/><line x1="16" y1="18" x2="16" y2="18.01"/><line x1="12" y1="18" x2="12" y2="18.01"/><line x1="8" y1="18" x2="8" y2="18.01"/>
      </svg>
    );

    const Menu = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    );

    const X = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const CheckSquare = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
      </svg>
    );

    const App = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [initialCapital, setInitialCapital] = useState("");
      const [currentBankroll, setCurrentBankroll] = useState(0);
      const [userStakeInput, setUserStakeInput] = useState(10);
      const [copySuccess, setCopySuccess] = useState(false);
      const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
      const [placedBets, setPlacedBets] = useState([]);
      const [settledBets, setSettledBets] = useState([]);

      const CONFIG = {
        geminiKey: "AIzaSyAbPdVSto0JMUr7AkEDCd8j3MeTTjTVlJI",
        oddsKey: "0d7491630a8624fe87ea1da0dad2ea3f",
        sheetId: "1seugfTs11E634y9_ILFwlZ0YxJmkO6mlJro6wTmnoaE"
      };

      // Load data from localStorage on mount
      useEffect(() => {
        const savedBankroll = localStorage.getItem('abis_bankroll');
        const savedPlacedBets = localStorage.getItem('abis_placed_bets');
        const savedSettledBets = localStorage.getItem('abis_settled_bets');
        
        if (savedBankroll) setCurrentBankroll(parseFloat(savedBankroll));
        if (savedPlacedBets) setPlacedBets(JSON.parse(savedPlacedBets));
        if (savedSettledBets) setSettledBets(JSON.parse(savedSettledBets));
      }, []);

      // Save to localStorage whenever data changes
      useEffect(() => {
        if (currentBankroll > 0) {
          localStorage.setItem('abis_bankroll', currentBankroll.toString());
        }
      }, [currentBankroll]);

      useEffect(() => {
        localStorage.setItem('abis_placed_bets', JSON.stringify(placedBets));
      }, [placedBets]);

      useEffect(() => {
        localStorage.setItem('abis_settled_bets', JSON.stringify(settledBets));
      }, [settledBets]);

      // Enhanced opportunities with diverse bet types and score predictions
      const opportunities = [
        {
          id: 1,
          type: 'Value Bet',
          event: 'Arsenal vs Man City',
          league: 'Premier League',
          bookie: 'Bet365',
          url: 'https://www.bet365.com',
          odds: 2.85,
          confidence: 88,
          customerType: 'Existing Customers',
          reasoning: "Historical H2H: Arsenal won 3 of last 5 at home. Market overreaction to City's injury list (KDB, Haaland out). Stats show Arsenal averaging 2.1 xG at Emirates this season vs top 6.",
          strategy: 'Diversification Recommended: Add 2 more bets from the list.',
          selection: 'Arsenal to Win',
          additionalBets: [
            { selection: 'Correct Score 2-1', odds: 9.50, confidence: 82, reasoning: "Arsenal's most common winning scoreline at home (28% of wins). City's defensive frailties without Stones." },
            { selection: 'Over 2.5 Goals', odds: 1.85, confidence: 84, reasoning: "Last 6 H2H averaged 3.2 goals. Both teams' defensive issues suggest open game." }
          ]
        },
        {
          id: 2,
          type: 'Matched Bet',
          event: 'Liverpool vs Everton',
          league: 'Premier League',
          bookie: 'SkyBet',
          url: 'https://www.skybet.com',
          laySite: 'Smarkets (Exchange)',
          layUrl: 'https://smarkets.com',
          odds: 2.1,
          layOdds: 2.14,
          confidence: 99,
          customerType: 'New Customers Only',
          offerDetails: 'Bet Â£10 Get Â£30 in Free Bets (Sign-up Offer)',
          reasoning: "Extremely low qualifying loss (Â£0.40). Exchange liquidity confirmed at Â£50k+. Historical data shows 94% success rate on Merseyside Derby over 1.5 goals.",
          strategy: 'High Priority: Focus on this before value bets.',
          selection: 'Over 1.5 Goals',
          additionalBets: [
            { selection: 'BTTS (Both Teams To Score)', odds: 2.20, confidence: 81, reasoning: "Derby intensity drives goals. Last 8 meetings: BTTS in 7. Everton desperate for points." }
          ]
        },
        {
          id: 3,
          type: 'Value Bet',
          event: 'Real Madrid vs Barcelona',
          league: 'La Liga',
          bookie: 'William Hill',
          url: 'https://www.williamhill.com',
          odds: 3.20,
          confidence: 85,
          customerType: 'Existing Customers',
          reasoning: "El ClÃ¡sico at BernabÃ©u. Madrid's home form: 8W-1D-0L. Barcelona's away record vs top 4: 2W-2D-3L. xG differential suggests 12% value vs market odds. Recent 3 meetings averaged 3.7 goals.",
          strategy: 'Single stake recommended due to variance.',
          selection: 'Real Madrid to Win',
          additionalBets: [
            { selection: 'Correct Score 3-2', odds: 18.00, confidence: 80, reasoning: "Most frequent ClÃ¡sico scoreline historically. Attacking firepower on both sides." },
            { selection: 'Over 3.5 Goals', odds: 2.40, confidence: 83, reasoning: "Recent ClÃ¡sicos: 4-0, 3-1, 2-3, 1-2. Averaging 3.7 goals. Both defenses vulnerable." },
            { selection: 'VinÃ­cius Anytime Scorer', odds: 2.10, confidence: 86, reasoning: "Scored in last 4 ClÃ¡sicos. 12 goals in 9 home games this season." }
          ]
        },
        {
          id: 4,
          type: 'Value Bet',
          event: 'Newcastle vs Brighton',
          league: 'Premier League',
          bookie: 'Betfair',
          url: 'https://www.betfair.com',
          odds: 2.45,
          confidence: 82,
          customerType: 'Existing Customers',
          reasoning: "Newcastle home dominance: 85% win rate vs mid-table teams. Brighton injury crisis (3 key defenders out). Stats: Newcastle averaging 1.8 xG at home, Brighton conceding 1.6 xGA away.",
          strategy: 'Combine with under 3.5 goals for insurance.',
          selection: 'Newcastle to Win',
          additionalBets: [
            { selection: 'Under 3.5 Goals', odds: 1.65, confidence: 81, reasoning: "Newcastle's defensive solidity. 73% of their home wins under 3 goals total." },
            { selection: 'Correct Score 2-0', odds: 8.00, confidence: 80, reasoning: "Newcastle's most common home winning scoreline (5 times this season)." }
          ]
        },
        {
          id: 5,
          type: 'Value Bet',
          event: 'Leeds vs Burnley',
          league: 'Championship',
          bookie: 'Paddy Power',
          url: 'https://www.paddypower.com',
          odds: 1.95,
          confidence: 81,
          customerType: 'Existing Customers',
          reasoning: "Championship analytics: Leeds 2.3 xG per game at Elland Road. Burnley's away form: 4L in last 6. Head-to-head: Leeds won 4 of last 5 meetings by 2+ goals.",
          strategy: 'Stake 1.5x normal for high-probability outcome.',
          selection: 'Leeds -1 Handicap',
          additionalBets: [
            { selection: 'Leeds to Win & Over 2.5', odds: 2.30, confidence: 82, reasoning: "Leeds score 2.8 goals per game at home. Burnley concede 1.9 away. Combo locks value." }
          ]
        },
        {
          id: 6,
          type: 'Value Bet',
          event: 'Bolton vs Derby',
          league: 'League One',
          bookie: 'Coral',
          url: 'https://www.coral.co.uk',
          odds: 2.10,
          confidence: 80,
          customerType: 'Existing Customers',
          reasoning: "League One stats: Bolton home win rate 71%. Derby missing top scorer (6 goals in 8 games). Bolton's pressing metrics rank #1 in division. Expected goals model shows 65% win probability.",
          strategy: 'Low-risk single recommended.',
          selection: 'Bolton to Win'
        },
        {
          id: 7,
          type: 'Value Bet',
          event: 'AtlÃ©tico Madrid vs Sevilla',
          league: 'La Liga',
          bookie: 'Bet365',
          url: 'https://www.bet365.com',
          odds: 1.72,
          confidence: 84,
          customerType: 'Existing Customers',
          reasoning: "AtlÃ©tico's fortress: 11W-2D-0L at Wanda Metropolitano. Sevilla's crisis: 1W in last 7 away. Simeone's defensive system limits opposition to 0.8 xG at home.",
          strategy: 'High-confidence banker bet.',
          selection: 'AtlÃ©tico to Win',
          additionalBets: [
            { selection: 'Under 2.5 Goals', odds: 1.90, confidence: 87, reasoning: "Simeone ball. 76% of AtlÃ©tico home games under 2.5. Sevilla averaging 0.9 goals away." },
            { selection: 'Correct Score 1-0', odds: 6.50, confidence: 81, reasoning: "AtlÃ©tico's signature scoreline. 42% of home wins are 1-0." }
          ]
        },
        {
          id: 8,
          type: 'Value Bet',
          event: 'Sheffield United vs Middlesbrough',
          league: 'Championship',
          bookie: 'William Hill',
          url: 'https://www.williamhill.com',
          odds: 2.05,
          confidence: 80,
          customerType: 'Existing Customers',
          reasoning: "Sheffield United's promotion push: 6W-1D-1L at home. Boro's travel sickness: 2W-3D-5L away. Steel City advantage worth 0.4 xG per game historically.",
          strategy: 'Combine with BTTS for safety net.',
          selection: 'Sheffield United to Win',
          additionalBets: [
            { selection: 'BTTS Yes', odds: 1.95, confidence: 82, reasoning: "Both teams score in 68% of Championship fixtures. Attacking quality on both sides." }
          ]
        },
        {
          id: 9,
          type: 'Value Bet',
          event: 'Manchester United vs Chelsea',
          league: 'Premier League',
          bookie: 'Betfair',
          url: 'https://www.betfair.com',
          odds: 2.60,
          confidence: 81,
          customerType: 'Existing Customers',
          reasoning: "United's resurgence under new tactics: 4W in last 5 at Old Trafford. Chelsea's defensive vulnerabilities exposed in last 3 away games (8 goals conceded).",
          strategy: 'Back goals in high-intensity fixture.',
          selection: 'Over 2.5 Goals',
          additionalBets: [
            { selection: 'BTTS & Over 2.5', odds: 2.40, confidence: 83, reasoning: "Last 5 H2H: all had 3+ goals and BTTS. Defensive frailties on both sides." },
            { selection: 'Correct Score 2-2', odds: 14.00, confidence: 80, reasoning: "Draw specialists recently. 2-2 occurred 3 times in last 8 meetings." }
          ]
        }
      ];

      const handleSetBankroll = () => {
        const val = parseFloat(initialCapital);
        if (!isNaN(val) && val > 0) setCurrentBankroll(val);
      };

      const handlePlaceBet = (opp, customStake) => {
        const stake = parseFloat(customStake) || parseFloat(userStakeInput);
        const newBet = {
          id: Date.now(),
          oppId: opp.id,
          event: opp.event,
          league: opp.league,
          selection: opp.selection,
          type: opp.type,
          bookie: opp.bookie,
          odds: opp.odds,
          stake: stake,
          potentialReturn: (stake * opp.odds).toFixed(2),
          profit: ((stake * opp.odds) - stake).toFixed(2),
          confidence: opp.confidence,
          placedAt: new Date().toISOString(),
          status: 'pending'
        };
        
        setPlacedBets([...placedBets, newBet]);
        setCurrentBankroll(prev => prev - stake);
      };

      const handleSettleBet = (betId, won) => {
        const bet = placedBets.find(b => b.id === betId);
        if (!bet) return;

        const settledBet = {
          ...bet,
          status: won ? 'won' : 'lost',
          settledAt: new Date().toISOString(),
          actualReturn: won ? parseFloat(bet.potentialReturn) : 0
        };

        setSettledBets([...settledBets, settledBet]);
        setPlacedBets(placedBets.filter(b => b.id !== betId));
        
        if (won) {
          setCurrentBankroll(prev => prev + parseFloat(bet.potentialReturn));
        }
      };

      const calculateStats = () => {
        const totalBets = settledBets.length;
        const wonBets = settledBets.filter(b => b.status === 'won').length;
        const totalStaked = settledBets.reduce((sum, b) => sum + b.stake, 0);
        const totalReturns = settledBets.reduce((sum, b) => sum + b.actualReturn, 0);
        const netProfit = totalReturns - totalStaked;
        const winRate = totalBets > 0 ? ((wonBets / totalBets) * 100).toFixed(1) : 0;

        return { totalBets, wonBets, totalStaked, totalReturns, netProfit, winRate };
      };

      const generateScript = () => `/**
 * ABIS UK LIVE PRODUCTION ENGINE - v2.0
 * Enhanced with bet tracking and multi-league support
 */

const GEMINI_API_KEY = "${CONFIG.geminiKey}";
const ODDS_API_KEY = "${CONFIG.oddsKey}";
const START_BAL = ${currentBankroll};
const MANUAL_SHEET_ID = "${CONFIG.sheetId}";

function getActiveSheet() {
  if (MANUAL_SHEET_ID !== "") {
    return SpreadsheetApp.openById(MANUAL_SHEET_ID);
  }
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  if (!ss) {
    throw new Error("No active spreadsheet. Open script via Extensions > Apps Script inside your Sheet.");
  }
  return ss;
}

function onOpen() {
  try {
    SpreadsheetApp.getUi()
      .createMenu('ðŸš€ ABIS System')
      .addItem('Initialize Environment', 'initialSetup')
      .addSeparator()
      .addItem('Sync Market Data', 'runAnalysis')
      .addItem('Update Placed Bets', 'syncPlacedBets')
      .addToUi();
  } catch (e) {
    Logger.log('UI Menu error: ' + e.message);
  }
}

function initialSetup() {
  const ss = getActiveSheet();
  const tabs = {
    'Config': [
      ['Key', 'Value'],
      ['GEMINI_KEY', GEMINI_API_KEY],
      ['ODDS_KEY', ODDS_API_KEY],
      ['START_BAL', START_BAL]
    ],
    'Recommendations': [
      ['Type', 'Event', 'League', 'Selection', 'Bookie', 'Odds', 'Confidence', 'Strategy']
    ],
    'Placed_Bets': [
      ['ID', 'Event', 'League', 'Selection', 'Stake', 'Odds', 'Potential_Return', 'Placed_Date', 'Status']
    ],
    'P_L_Trends': [
      ['Date', 'Balance', 'Net_Profit', 'Win_Rate']
    ]
  };
  
  Object.keys(tabs).forEach(tabName => {
    let sheet = ss.getSheetByName(tabName) || ss.insertSheet(tabName);
    sheet.clear();
    sheet.getRange(1, 1, tabs[tabName].length, tabs[tabName][0].length)
         .setValues(tabs[tabName]);
    Logger.log('Provisioned: ' + tabName);
  });

  Logger.log('âœ… ABIS ENGINE INITIALIZATION COMPLETE');
  
  try {
    SpreadsheetApp.getUi().alert('âœ… PROVISIONING SUCCESSFUL\\n\\nAll sheets configured. Gemini bridge active.');
  } catch(e) {
    Logger.log('Alert skipped in headless mode');
  }
}

function syncPlacedBets() {
  const ss = getActiveSheet();
  const sheet = ss.getSheetByName('Placed_Bets');
  
  // This would sync with your frontend app data
  // For now, it logs the current placed bets
  Logger.log('Syncing placed bets...');
  
  const lastRow = sheet.getLastRow();
  if (lastRow > 1) {
    const data = sheet.getRange(2, 1, lastRow - 1, 9).getValues();
    Logger.log('Found ' + (lastRow - 1) + ' placed bets');
  } else {
    Logger.log('No placed bets found');
  }
}

function runAnalysis() {
  const ss = getActiveSheet();
  Logger.log('ðŸ”„ Syncing with Odds API & Gemini Intelligence...');
  
  // Fetch live odds from API
  const oddsUrl = 'https://api.the-odds-api.com/v4/sports/soccer_epl/odds/?apiKey=' + ODDS_API_KEY + '&regions=uk&markets=h2h';
  
  try {
    const response = UrlFetchApp.fetch(oddsUrl);
    const data = JSON.parse(response.getContentText());
    Logger.log('âœ… Fetched ' + data.length + ' live matches');
    
    // Process and store recommendations
    const recsSheet = ss.getSheetByName('Recommendations');
    // Add your processing logic here
    
  } catch(e) {
    Logger.log('âŒ API Error: ' + e.message);
  }
}`;

      const copyToClipboard = () => {
        const el = document.createElement('textarea');
        el.value = generateScript();
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        setCopySuccess(true);
        setTimeout(() => setCopySuccess(false), 2000);
      };

      const OpportunityCard = ({ opp }) => {
        const [customStake, setCustomStake] = useState('');
        const [isPlacing, setIsPlacing] = useState(false);
        const [showAdditional, setShowAdditional] = useState(false);
        const stakeToUse = customStake || userStakeInput;
        const potReturn = (stakeToUse * opp.odds).toFixed(2);
        const profit = (potReturn - stakeToUse).toFixed(2);
        const alreadyPlaced = placedBets.some(b => b.oppId === opp.id);

        return (
          <div className="bg-slate-900 border border-slate-800 rounded-3xl p-6 flex flex-col hover:border-blue-500/50 transition-all shadow-xl">
            <div className="flex justify-between items-start mb-4">
              <span className={`px-3 py-1 rounded-full text-[10px] font-black uppercase ${opp.type === 'Matched Bet' ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'bg-blue-500/10 text-blue-400 border border-blue-500/20'}`}>
                {opp.type}
              </span>
              <div className="text-right">
                <span className="text-[10px] text-slate-500 font-bold block uppercase tracking-widest">Confidence</span>
                <span className="text-lg font-black text-white">{opp.confidence}%</span>
              </div>
            </div>

            <h3 className="text-xl font-bold text-white mb-1">{opp.event}</h3>
            <p className="text-xs text-blue-400 font-bold mb-4">{opp.league}</p>
            
            <div className="flex items-center gap-2 mb-4 text-xs text-slate-400 bg-slate-800/50 w-fit px-3 py-1.5 rounded-lg border border-slate-700">
              <Users size={14} className="text-blue-400" />
              <span className="font-bold">{opp.customerType}</span>
            </div>

            <div className="mb-4 p-3 bg-blue-500/5 rounded-xl border border-blue-500/10">
              <p className="text-[10px] text-blue-400 font-black uppercase mb-1">Selection</p>
              <p className="text-sm text-white font-bold">{opp.selection}</p>
            </div>

            <div className="grid grid-cols-1 gap-3 mb-4">
              <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                <div className="flex justify-between items-center mb-1">
                  <p className="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Bookmaker</p>
                  <a href={opp.url} target="_blank" rel="noopener noreferrer" className="text-[10px] text-blue-400 hover:underline flex items-center gap-1">
                    Visit Site <ArrowUpRight size={10}/>
                  </a>
                </div>
                <p className="text-sm font-bold text-white">{opp.bookie} @ <span className="text-blue-400">{opp.odds}</span></p>
              </div>
              
              {opp.type === 'Matched Bet' && (
                <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800">
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-[10px] text-pink-500 font-bold uppercase tracking-wider">Lay Exchange</p>
                    <a href={opp.layUrl} target="_blank" rel="noopener noreferrer" className="text-[10px] text-pink-400 hover:underline flex items-center gap-1">
                      Visit Site <ArrowUpRight size={10}/>
                    </a>
                  </div>
                  <p className="text-sm font-bold text-white">{opp.laySite} @ <span className="text-pink-400">{opp.layOdds}</span></p>
                </div>
              )}
            </div>

            {opp.offerDetails && (
              <div className="mb-4 p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl flex gap-3 items-start">
                <Gift className="w-5 h-5 text-emerald-500 shrink-0 mt-0.5" />
                <p className="text-xs text-slate-300 font-medium leading-snug">{opp.offerDetails}</p>
              </div>
            )}

            <div className="mb-4 space-y-3">
              <div className="p-3 bg-blue-500/5 rounded-xl border border-blue-500/10">
                <p className="text-[10px] text-blue-400 font-black uppercase mb-1">Strategy</p>
                <p className="text-xs text-slate-400 italic leading-relaxed font-medium">"{opp.strategy}"</p>
              </div>
              <p className="text-xs text-slate-500 leading-relaxed font-medium">
                <span className="text-slate-300 font-bold">Analysis:</span> {opp.reasoning}
              </p>
            </div>

            {/* Additional Bet Options */}
            {opp.additionalBets && opp.additionalBets.length > 0 && (
              <div className="mb-4">
                <button
                  onClick={() => setShowAdditional(!showAdditional)}
                  className="w-full p-3 bg-amber-500/5 border border-amber-500/20 rounded-xl flex items-center justify-between hover:bg-amber-500/10 transition-all"
                >
                  <div className="flex items-center gap-2">
                    <Zap className="text-amber-400" size={14} />
                    <span className="text-xs font-black text-amber-400 uppercase">
                      +{opp.additionalBets.length} Alternative Bet{opp.additionalBets.length > 1 ? 's' : ''} Available
                    </span>
                  </div>
                  <span className="text-amber-400 text-xs font-bold">
                    {showAdditional ? 'â–¼' : 'â–¶'}
                  </span>
                </button>

                {showAdditional && (
                  <div className="mt-3 space-y-2 animate-in fade-in">
                    {opp.additionalBets.map((addBet, idx) => (
                      <div key={idx} className="p-4 bg-slate-950 border border-slate-700 rounded-xl">
                        <div className="flex justify-between items-start mb-2">
                          <div className="flex-1">
                            <p className="text-sm font-bold text-white mb-1">{addBet.selection}</p>
                            <p className="text-[10px] text-slate-500 leading-relaxed">{addBet.reasoning}</p>
                          </div>
                          <div className="text-right ml-3">
                            <p className="text-[9px] text-slate-500 uppercase mb-0.5">Odds</p>
                            <p className="text-lg font-black text-emerald-400">{addBet.odds}</p>
                          </div>
                        </div>
                        <div className="flex items-center justify-between pt-2 border-t border-slate-800">
                          <div className="flex items-center gap-2">
                            <span className="text-[10px] text-slate-500 uppercase">Confidence</span>
                            <span className="text-xs font-bold text-white">{addBet.confidence}%</span>
                          </div>
                          <button
                            onClick={() => {
                              const newOpp = {
                                ...opp,
                                id: Date.now() + idx,
                                selection: addBet.selection,
                                odds: addBet.odds,
                                confidence: addBet.confidence,
                                reasoning: addBet.reasoning
                              };
                              handlePlaceBet(newOpp, customStake);
                            }}
                            disabled={currentBankroll < stakeToUse}
                            className="px-4 py-1.5 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg text-[10px] font-black transition-all"
                          >
                            PLACE
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Stake Input */}
            {!alreadyPlaced && (
              <div className="mb-4 p-4 bg-slate-950 rounded-2xl border border-slate-700">
                <p className="text-[10px] text-slate-500 font-black uppercase mb-2">Custom Stake (Optional)</p>
                <div className="flex items-center">
                  <span className="text-lg font-black text-slate-500 mr-1">Â£</span>
                  <input 
                    type="number"
                    placeholder={userStakeInput}
                    className="bg-transparent text-lg font-bold text-white w-full focus:outline-none"
                    value={customStake}
                    onChange={(e) => setCustomStake(e.target.value)}
                  />
                </div>
              </div>
            )}

            <div className="mt-auto pt-4 border-t border-slate-800">
              {alreadyPlaced ? (
                <div className="flex items-center justify-center gap-2 p-4 bg-emerald-500/10 rounded-xl border border-emerald-500/20">
                  <CheckSquare size={20} className="text-emerald-400" />
                  <span className="text-sm font-bold text-emerald-400">Bet Placed - Track in History</span>
                </div>
              ) : (
                <>
                  <div className="flex justify-between items-center mb-4">
                    <div>
                      <p className="text-[10px] text-slate-500 font-black tracking-widest uppercase">Est. Return</p>
                      <p className="text-2xl font-black text-emerald-400">Â£{potReturn}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-[10px] text-slate-500 font-black tracking-widest uppercase">Net Profit</p>
                      <p className="text-lg font-bold text-white">Â£{profit}</p>
                    </div>
                  </div>
                  <button
                    onClick={() => {
                      setIsPlacing(true);
                      setTimeout(() => {
                        handlePlaceBet(opp, customStake);
                        setIsPlacing(false);
                      }, 500);
                    }}
                    disabled={isPlacing || currentBankroll < stakeToUse}
                    className="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 text-white py-4 rounded-2xl font-black text-sm transition-all active:scale-95"
                  >
                    {isPlacing ? 'PLACING...' : currentBankroll < stakeToUse ? 'INSUFFICIENT BANKROLL' : 'PLACE BET'}
                  </button>
                </>
              )}
            </div>
          </div>
        );
      };

      const stats = calculateStats();

      return (
        <div className="min-h-screen bg-slate-950 text-slate-200">
          
          {/* Persistent Navigation Header */}
          <nav className="fixed top-0 left-0 right-0 h-20 bg-slate-900/80 backdrop-blur-xl border-b border-slate-800 z-50 px-6 lg:px-12 flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="bg-blue-600 p-2 rounded-xl shadow-lg shadow-blue-600/20">
                <Shield className="text-white" size={24} />
              </div>
              <div>
                <h1 className="text-xl font-black text-white tracking-tighter uppercase italic">ABIS Live</h1>
                <p className="text-[9px] text-blue-400 font-black tracking-[0.2em] uppercase">UK Intelligence v2.0</p>
              </div>
            </div>

            {/* Desktop Nav */}
            <div className="hidden lg:flex items-center gap-2">
              {[
                { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
                { id: 'setup', label: 'Provisioning', icon: Database },
                { id: 'history', label: 'Bet History', icon: History }
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`px-6 py-2.5 rounded-full text-sm font-bold transition-all flex items-center gap-2 ${activeTab === tab.id ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`}
                >
                  <tab.icon size={16} /> {tab.label}
                </button>
              ))}
            </div>

            <button className="lg:hidden text-white" onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
              {isMobileMenuOpen ? <X /> : <Menu />}
            </button>
          </nav>

          {/* Mobile Menu */}
          {isMobileMenuOpen && (
            <div className="fixed inset-0 top-20 bg-slate-950 z-40 p-6 flex flex-col gap-4 lg:hidden">
              {['dashboard', 'setup', 'history'].map(id => (
                <button
                  key={id}
                  onClick={() => { setActiveTab(id); setIsMobileMenuOpen(false); }}
                  className={`w-full p-4 rounded-2xl text-left font-bold capitalize ${activeTab === id ? 'bg-blue-600' : 'bg-slate-900'}`}
                >
                  {id === 'setup' ? 'Provisioning' : id}
                </button>
              ))}
            </div>
          )}

          <main className="pt-28 pb-12 px-6 lg:px-12 max-w-[1600px] mx-auto">
            
            {activeTab === 'dashboard' && (
              <div className="animate-in fade-in slide-in-from-bottom-4 duration-700">
                <header className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 mb-12">
                  <div>
                    <h2 className="text-3xl font-black text-white tracking-tight">Active Signals</h2>
                    <p className="text-slate-500 font-medium">Real-time UK & European Market Analysis</p>
                  </div>

                  <div className="flex items-center gap-4 bg-slate-900 p-2 rounded-[2rem] border border-slate-800 shadow-2xl w-full lg:w-auto">
                    <div className="flex items-center gap-3 px-4">
                      <Wallet className="text-blue-400" size={20} />
                      <input 
                        type="number"
                        placeholder="Enter Initial Bankroll"
                        className="bg-transparent border-none text-white font-black text-lg focus:outline-none w-32 placeholder:text-slate-700"
                        value={initialCapital}
                        onChange={(e) => setInitialCapital(e.target.value)}
                      />
                    </div>
                    <button 
                      onClick={handleSetBankroll}
                      className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-2xl text-xs font-black transition-all active:scale-95"
                    >
                      INITIALIZE
                    </button>
                  </div>
                </header>

                {currentBankroll === 0 ? (
                  <div className="py-32 flex flex-col items-center justify-center bg-slate-900/40 border-2 border-dashed border-slate-800 rounded-[3rem]">
                    <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-6">
                      <Database className="text-slate-600" size={32} />
                    </div>
                    <h3 className="text-2xl font-black text-white mb-2">Blank Slate</h3>
                    <p className="text-slate-500 text-center max-w-sm px-8 font-medium">
                      Initialize your bankroll above to unlock Profit/Loss trends and live betting recommendations.
                    </p>
                  </div>
                ) : (
                  <>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                      <div className="bg-slate-900 p-8 rounded-[2rem] border border-slate-800 shadow-xl">
                        <p className="text-[10px] text-slate-500 font-black uppercase mb-2 tracking-widest">Current Bankroll</p>
                        <h4 className="text-3xl font-black text-white">Â£{currentBankroll.toFixed(2)}</h4>
                      </div>
                      <div className="bg-slate-900 p-8 rounded-[2rem] border border-slate-800 shadow-xl">
                        <p className="text-[10px] text-slate-500 font-black uppercase mb-2 tracking-widest">Total P/L</p>
                        <h4 className={`text-3xl font-black ${stats.netProfit >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                          Â£{stats.netProfit.toFixed(2)}
                        </h4>
                      </div>
                      <div className="bg-slate-900 p-8 rounded-[2rem] border border-slate-800 shadow-xl">
                        <p className="text-[10px] text-slate-500 font-black uppercase mb-2 tracking-widest">Win Rate</p>
                        <div className="flex items-center gap-2 mt-2">
                          <TrendingUp className="text-emerald-500" size={16} />
                          <span className="text-2xl font-bold text-white">{stats.winRate}%</span>
                        </div>
                        <p className="text-xs text-slate-500 mt-1">{stats.wonBets}/{stats.totalBets} wins</p>
                      </div>
                      <div className="bg-slate-900 p-8 rounded-[2rem] border-2 border-blue-500/30 shadow-2xl bg-gradient-to-br from-slate-900 to-blue-900/10">
                        <div className="flex justify-between items-center mb-2">
                          <p className="text-[10px] text-blue-400 font-black uppercase tracking-widest">Default Stake</p>
                          <Calculator size={14} className="text-blue-400" />
                        </div>
                        <div className="flex items-center">
                          <span className="text-2xl font-black text-slate-500 mr-1">Â£</span>
                          <input 
                            type="number"
                            className="bg-transparent text-3xl font-black text-white w-full focus:outline-none"
                            value={userStakeInput}
                            onChange={(e) => setUserStakeInput(parseFloat(e.target.value) || 10)}
                          />
                        </div>
                      </div>
                    </div>

                    {/* Pending Bets Section */}
                    {placedBets.length > 0 && (
                      <div className="mb-12">
                        <h3 className="text-xs font-black text-slate-500 uppercase tracking-[0.3em] flex items-center gap-3 mb-6">
                          <CheckSquare size={16} className="text-amber-400" /> Pending Bets ({placedBets.length})
                        </h3>
                        <div className="grid gap-4">
                          {placedBets.map(bet => (
                            <div key={bet.id} className="bg-slate-900 border border-slate-800 rounded-2xl p-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                              <div className="flex-1">
                                <h4 className="text-lg font-bold text-white mb-1">{bet.event}</h4>
                                <p className="text-xs text-blue-400 font-bold mb-2">{bet.league} â€¢ {bet.selection}</p>
                                <div className="flex gap-4 text-xs text-slate-400">
                                  <span>Stake: <b className="text-white">Â£{bet.stake}</b></span>
                                  <span>Odds: <b className="text-white">{bet.odds}</b></span>
                                  <span>Return: <b className="text-emerald-400">Â£{bet.potentialReturn}</b></span>
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => handleSettleBet(bet.id, true)}
                                  className="bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-3 rounded-xl text-xs font-black transition-all"
                                >
                                  WON
                                </button>
                                <button
                                  onClick={() => handleSettleBet(bet.id, false)}
                                  className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-xl text-xs font-black transition-all"
                                >
                                  LOST
                                </button>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    <div className="mb-12">
                      <h3 className="text-xs font-black text-slate-500 uppercase tracking-[0.3em] flex items-center gap-3 mb-8">
                        <Zap className="text-amber-400 fill-amber-400" size={16} /> Live Recommendations
                      </h3>
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {opportunities
                          .filter(opp => opp.confidence >= 80)
                          .map(opp => <OpportunityCard key={opp.id} opp={opp} />)
                        }
                      </div>
                    </div>
                  </>
                )}
              </div>
            )}

            {activeTab === 'setup' && (
              <div className="max-w-4xl mx-auto animate-in slide-in-from-bottom-8 duration-700">
                <header className="mb-12">
                  <h2 className="text-4xl font-black text-white mb-4 tracking-tighter italic uppercase">Provisioning Engine</h2>
                  <p className="text-slate-400 text-lg font-medium">Deploying the ABIS Backend to your Google Sheets environment.</p>
                </header>

                <div className="grid gap-12">
                  <section className="relative pl-16">
                    <div className="absolute left-0 top-0 w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center font-black text-white text-xl">1</div>
                    <h3 className="text-xl font-bold text-white mb-2">Create Environment</h3>
                    <p className="text-slate-400 text-sm leading-relaxed mb-4">
                      Open a new <a href="https://sheets.new" target="_blank" rel="noopener noreferrer" className="text-blue-400 font-bold underline">Google Sheet</a> and name it <b>"ABIS UK Prod"</b>. 
                      Navigate to <b>Extensions &gt; Apps Script</b>.
                    </p>
                  </section>

                  <section className="relative pl-16">
                    <div className="absolute left-0 top-0 w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center font-black text-white text-xl">2</div>
                    <h3 className="text-xl font-bold text-white mb-2">Inject Logic Layer</h3>
                    <p className="text-slate-400 text-sm mb-6 leading-relaxed">
                      Copy the generated script below. Your API keys and starting bankroll of <b>Â£{currentBankroll}</b> are automatically integrated.
                    </p>
                    
                    <div className="relative group rounded-3xl overflow-hidden border border-slate-800 shadow-2xl">
                      <div className="absolute right-6 top-6 z-10">
                        <button 
                          onClick={copyToClipboard}
                          className="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl text-xs font-black flex items-center gap-2 shadow-xl active:scale-95 transition-all"
                        >
                          {copySuccess ? <CheckCircle2 size={16}/> : <Copy size={16}/>}
                          {copySuccess ? 'COPIED' : 'COPY BACKEND SCRIPT'}
                        </button>
                      </div>
                      <pre className="bg-slate-950 p-10 pt-20 text-[11px] font-mono text-blue-300 overflow-x-auto max-h-[400px] scrollbar-hide">
                        {generateScript()}
                      </pre>
                    </div>
                  </section>

                  <section className="relative pl-16">
                    <div className="absolute left-0 top-0 w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center font-black text-white text-xl">3</div>
                    <h3 className="text-xl font-bold text-white mb-2">Finalize Provisioning</h3>
                    <p className="text-slate-400 text-sm leading-relaxed mb-6">
                      Paste the code into the Apps Script editor, click <b>Save</b>, and <b>Refresh</b> your Google Sheet. 
                      A new menu <b>ðŸš€ ABIS System</b> will appear. Click it and select <b>Initialize Environment</b>.
                    </p>
                    <div className="p-6 bg-blue-500/5 border border-blue-500/20 rounded-[2rem] flex items-center gap-4">
                      <div className="bg-blue-600 p-2 rounded-xl"><Info size={20}/></div>
                      <p className="text-xs text-blue-400 font-bold leading-relaxed italic">
                        This builds the Config, Recommendations, Placed_Bets, and P&L history tabs automatically.
                      </p>
                    </div>
                  </section>
                </div>
              </div>
            )}

            {activeTab === 'history' && (
              <div className="animate-in fade-in duration-500">
                {settledBets.length === 0 ? (
                  <div className="text-center py-40">
                    <div className="p-6 bg-slate-900 rounded-full w-fit mx-auto mb-6">
                      <History className="text-slate-700" size={40} />
                    </div>
                    <h3 className="text-2xl font-black text-white mb-2 tracking-tight uppercase italic">No History Found</h3>
                    <p className="text-slate-500 max-w-sm mx-auto font-medium">
                      Bet history will populate once you place and settle bets from the dashboard.
                    </p>
                  </div>
                ) : (
                  <div>
                    <header className="mb-8">
                      <h2 className="text-3xl font-black text-white mb-2">Bet History</h2>
                      <p className="text-slate-500">Complete record of all settled bets</p>
                    </header>

                    <div className="grid gap-4">
                      {settledBets.map(bet => (
                        <div key={bet.id} className={`bg-slate-900 border rounded-2xl p-6 ${bet.status === 'won' ? 'border-emerald-500/30' : 'border-red-500/30'}`}>
                          <div className="flex flex-col md:flex-row justify-between gap-4">
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-2">
                                <span className={`px-3 py-1 rounded-full text-[10px] font-black uppercase ${bet.status === 'won' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}>
                                  {bet.status.toUpperCase()}
                                </span>
                                <span className="text-xs text-slate-500">
                                  {new Date(bet.settledAt).toLocaleDateString()}
                                </span>
                              </div>
                              <h4 className="text-lg font-bold text-white mb-1">{bet.event}</h4>
                              <p className="text-xs text-blue-400 font-bold mb-3">{bet.league} â€¢ {bet.selection}</p>
                              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs">
                                <div>
                                  <p className="text-slate-500 uppercase text-[10px] mb-1">Stake</p>
                                  <p className="text-white font-bold">Â£{bet.stake.toFixed(2)}</p>
                                </div>
                                <div>
                                  <p className="text-slate-500 uppercase text-[10px] mb-1">Odds</p>
                                  <p className="text-white font-bold">{bet.odds}</p>
                                </div>
                                <div>
                                  <p className="text-slate-500 uppercase text-[10px] mb-1">Return</p>
                                  <p className="text-white font-bold">Â£{bet.actualReturn.toFixed(2)}</p>
                                </div>
                                <div>
                                  <p className="text-slate-500 uppercase text-[10px] mb-1">Profit</p>
                                  <p className={`font-bold ${bet.status === 'won' ? 'text-emerald-400' : 'text-red-400'}`}>
                                    Â£{(bet.actualReturn - bet.stake).toFixed(2)}
                                  </p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
