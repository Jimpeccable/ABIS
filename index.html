<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ABIS Live - Real Madrid & Barcelona Intelligence</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: 0; }
    }
    .animate-in { animation: fadeIn 0.7s ease-out; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-slate-950 text-slate-200">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // ============================================================================
    // API CONFIGURATION - LIVE KEYS
    // ============================================================================
    const API_CONFIG = {
      GEMINI_KEY: "AIzaSyAbPdVSto0JMUr7AkEDCd8j3MeTTjTVlJI",
      ODDS_KEY: "0d7491630a8624fe87ea1da0dad2ea3f",
      WEBAPP_URL: "https://script.google.com/macros/s/AKfycbzdikJYwTZP6dQdRv6y8In6w0_iAmrihouWhD_22yXlS1YeUJyY-V1US5C3mW_M8H4A/exec"
    };

    // ============================================================================
    // ICONS
    // ============================================================================
    const Shield = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
    );

    const TrendingUp = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
      </svg>
    );

    const Zap = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2">
        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
      </svg>
    );

    const LayoutDashboard = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/>
      </svg>
    );

    const Database = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
      </svg>
    );

    const Menu = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    );

    const X = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const RefreshCw = ({size=24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
      </svg>
    );

    // ============================================================================
    // MAIN APP
    // ============================================================================
    const App = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
      const [liveOpportunities, setLiveOpportunities] = useState([]);
      const [rmBarcaMatches, setRmBarcaMatches] = useState([]);
      const [isLoadingDashboard, setIsLoadingDashboard] = useState(false);
      const [isLoadingRmBarca, setIsLoadingRmBarca] = useState(false);
      const [isConnected, setIsConnected] = useState(false);
      const [lastUpdate, setLastUpdate] = useState(null);

      // ========================================================================
      // TEST CONNECTION ON MOUNT
      // ========================================================================
      useEffect(() => {
        testConnection();
      }, []);

      const testConnection = async () => {
        try {
          console.log('üîó Testing connection to Google Sheets...');
          const response = await fetch(API_CONFIG.WEBAPP_URL + '?action=test', {
            method: 'GET',
            mode: 'no-cors'
          });
          
          // With no-cors, we can't read the response, but if it doesn't throw, connection works
          setIsConnected(true);
          console.log('‚úÖ Connected to Google Sheets');
        } catch (error) {
          console.log('‚ö†Ô∏è Google Sheets connection failed, using direct API mode');
          setIsConnected(false);
        }
      };

      // ========================================================================
      // FETCH LIVE DATA FROM GOOGLE SHEETS (calls Apps Script)
      // ========================================================================
      const fetchLiveOpportunitiesFromSheets = async () => {
        setIsLoadingDashboard(true);
        try {
          console.log('üì° Fetching live opportunities from Google Sheets...');
          const response = await fetch(API_CONFIG.WEBAPP_URL + '?action=getRecommendations', {
            method: 'GET'
          });
          
          const data = await response.json();
          
          if (data.status === 'ok' && data.recommendations) {
            setLiveOpportunities(data.recommendations);
            setLastUpdate(new Date());
            console.log('‚úÖ Loaded', data.recommendations.length, 'opportunities');
          }
        } catch (error) {
          console.error('‚ùå Failed to fetch opportunities:', error);
        } finally {
          setIsLoadingDashboard(false);
        }
      };

      const fetchRmBarcaFromSheets = async () => {
        setIsLoadingRmBarca(true);
        try {
          console.log('üì° Fetching Real Madrid & Barcelona matches from Google Sheets...');
          const response = await fetch(API_CONFIG.WEBAPP_URL + '?action=getElClasico', {
            method: 'GET'
          });
          
          const data = await response.json();
          
          if (data.status === 'ok' && data.matches) {
            setRmBarcaMatches(data.matches);
            setLastUpdate(new Date());
            console.log('‚úÖ Loaded', data.matches.length, 'RM/Bar√ßa matches');
          }
        } catch (error) {
          console.error('‚ùå Failed to fetch RM/Bar√ßa matches:', error);
        } finally {
          setIsLoadingRmBarca(false);
        }
      };

      // ========================================================================
      // AUTO-FETCH ON TAB CHANGE
      // ========================================================================
      useEffect(() => {
        if (activeTab === 'dashboard' && liveOpportunities.length === 0) {
          fetchLiveOpportunitiesFromSheets();
        }
      }, [activeTab]);

      useEffect(() => {
        if (activeTab === 'rmbarca' && rmBarcaMatches.length === 0) {
          fetchRmBarcaFromSheets();
        }
      }, [activeTab]);

      // ========================================================================
      // RENDER
      // ========================================================================
      return (
        <div className="min-h-screen">
          {/* Header */}
          <header className="fixed top-0 left-0 right-0 bg-slate-900/95 backdrop-blur-md border-b border-slate-800 z-50">
            <div className="max-w-[1600px] mx-auto px-6 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="bg-gradient-to-br from-blue-500 to-purple-600 p-2 rounded-xl">
                  <Shield size={24} className="text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-black text-white">ABIS LIVE</h1>
                  <p className="text-xs text-slate-400 font-medium">Real-Time Intelligence v3.1</p>
                </div>
              </div>

              {/* Desktop Nav */}
              <div className="hidden lg:flex items-center gap-2">
                {[
                  { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
                  { id: 'rmbarca', label: 'RM & Bar√ßa', icon: TrendingUp },
                  { id: 'provisioning', label: 'Provisioning', icon: Database }
                ].map(tab => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={`px-6 py-2.5 rounded-full text-sm font-bold transition-all flex items-center gap-2 ${
                      activeTab === tab.id ? 'bg-blue-600 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800'
                    }`}
                  >
                    <tab.icon size={16} /> {tab.label}
                  </button>
                ))}
              </div>

              {/* Status */}
              <div className="hidden lg:flex items-center gap-3">
                <div className={`flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold ${
                  isConnected ? 'bg-emerald-500/20 text-emerald-400' : 'bg-slate-800 text-slate-400'
                }`}>
                  <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-emerald-400' : 'bg-slate-600'}`} />
                  {isConnected ? 'LIVE' : 'OFFLINE'}
                </div>
              </div>

              {/* Mobile Menu Button */}
              <button
                className="lg:hidden"
                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              >
                {isMobileMenuOpen ? <X /> : <Menu />}
              </button>
            </div>
          </header>

          {/* Mobile Menu */}
          {isMobileMenuOpen && (
            <div className="fixed inset-0 top-20 bg-slate-950 z-40 p-6 flex flex-col gap-4 lg:hidden">
              {['dashboard', 'rmbarca', 'provisioning'].map(id => (
                <button
                  key={id}
                  onClick={() => { setActiveTab(id); setIsMobileMenuOpen(false); }}
                  className={`w-full p-4 rounded-2xl text-left font-bold capitalize ${
                    activeTab === id ? 'bg-blue-600' : 'bg-slate-900'
                  }`}
                >
                  {id === 'rmbarca' ? 'RM & Bar√ßa' : id}
                </button>
              ))}
            </div>
          )}

          <main className="pt-28 pb-12 px-6 lg:px-12 max-w-[1600px] mx-auto">
            
            {/* ============================================================ */}
            {/* DASHBOARD TAB */}
            {/* ============================================================ */}
            {activeTab === 'dashboard' && (
              <div className="animate-in fade-in duration-700">
                <header className="flex justify-between items-center mb-8">
                  <div>
                    <h2 className="text-3xl font-black text-white tracking-tight mb-2">Live Opportunities</h2>
                    <p className="text-slate-500 font-medium">AI-powered betting intelligence from multiple sources</p>
                  </div>
                  <button
                    onClick={fetchLiveOpportunitiesFromSheets}
                    disabled={isLoadingDashboard}
                    className="bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 text-white px-6 py-3 rounded-2xl text-xs font-black transition-all flex items-center gap-2"
                  >
                    <RefreshCw size={16} className={isLoadingDashboard ? 'animate-spin' : ''} />
                    {isLoadingDashboard ? 'LOADING...' : 'REFRESH'}
                  </button>
                </header>

                {isLoadingDashboard ? (
                  <div className="text-center py-20">
                    <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4" />
                    <p className="text-slate-400 font-bold">Fetching live data from APIs...</p>
                  </div>
                ) : liveOpportunities.length === 0 ? (
                  <div className="text-center py-20 bg-slate-900/40 border-2 border-dashed border-slate-800 rounded-[3rem]">
                    <TrendingUp className="text-slate-600 mx-auto mb-6" size={64} />
                    <h3 className="text-2xl font-black text-white mb-2">No Opportunities Yet</h3>
                    <p className="text-slate-500 max-w-sm mx-auto font-medium mb-6">
                      Click REFRESH to fetch live betting opportunities from The Odds API and Gemini AI
                    </p>
                    <button
                      onClick={fetchLiveOpportunitiesFromSheets}
                      className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-2xl font-black text-sm transition-all"
                    >
                      FETCH LIVE DATA
                    </button>
                  </div>
                ) : (
                  <div className="grid gap-6">
                    {liveOpportunities.map((opp, idx) => (
                      <div key={idx} className="bg-slate-900 border-2 border-blue-500/30 rounded-3xl p-6">
                        <div className="flex items-start justify-between mb-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                              <span className="bg-blue-600 text-white text-xs font-black px-3 py-1 rounded-full uppercase">
                                {opp.confidence}% CONFIDENCE
                              </span>
                              <span className="text-xs text-slate-500 uppercase font-bold">{opp.league}</span>
                            </div>
                            <h3 className="text-xl font-black text-white mb-2">{opp.event}</h3>
                            <p className="text-sm text-slate-400">{opp.reasoning}</p>
                          </div>
                        </div>
                        
                        <div className="grid grid-cols-3 gap-4 bg-slate-950 p-4 rounded-2xl">
                          <div>
                            <p className="text-xs text-slate-500 uppercase mb-1">Selection</p>
                            <p className="text-lg font-black text-emerald-400">{opp.selection}</p>
                          </div>
                          <div>
                            <p className="text-xs text-slate-500 uppercase mb-1">Odds</p>
                            <p className="text-lg font-black text-blue-400">{opp.odds.toFixed(2)}</p>
                          </div>
                          <div>
                            <p className="text-xs text-slate-500 uppercase mb-1">Bookmaker</p>
                            <p className="text-sm font-bold text-white">{opp.bookie}</p>
                          </div>
                        </div>

                        {opp.predictedScore && opp.predictedScore !== 'N/A' && (
                          <div className="mt-4 bg-gradient-to-r from-emerald-500/20 to-blue-500/20 border-2 border-emerald-500/50 rounded-xl p-4 text-center">
                            <p className="text-xs text-emerald-400 font-black uppercase mb-1">AI Predicted Score</p>
                            <p className="text-3xl font-black text-white">{opp.predictedScore}</p>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* ============================================================ */}
            {/* REAL MADRID & BARCELONA TAB */}
            {/* ============================================================ */}
            {activeTab === 'rmbarca' && (
              <div className="animate-in fade-in duration-700">
                <header className="flex justify-between items-center mb-8">
                  <div>
                    <h2 className="text-3xl font-black text-white tracking-tight mb-2">Real Madrid & Barcelona</h2>
                    <p className="text-slate-500 font-medium">AI-powered score predictions for upcoming matches</p>
                  </div>
                  <button
                    onClick={fetchRmBarcaFromSheets}
                    disabled={isLoadingRmBarca}
                    className="bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 text-white px-6 py-3 rounded-2xl text-xs font-black transition-all flex items-center gap-2"
                  >
                    <RefreshCw size={16} className={isLoadingRmBarca ? 'animate-spin' : ''} />
                    {isLoadingRmBarca ? 'LOADING...' : 'REFRESH'}
                  </button>
                </header>

                {isLoadingRmBarca ? (
                  <div className="text-center py-20">
                    <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4" />
                    <p className="text-slate-400 font-bold">Fetching predictions...</p>
                  </div>
                ) : rmBarcaMatches.length === 0 ? (
                  <div className="text-center py-20 bg-slate-900/40 border-2 border-dashed border-slate-800 rounded-[3rem]">
                    <TrendingUp className="text-slate-600 mx-auto mb-6" size={64} />
                    <h3 className="text-2xl font-black text-white mb-2">No Upcoming Matches</h3>
                    <p className="text-slate-500 max-w-sm mx-auto font-medium mb-6">
                      No Real Madrid or Barcelona matches in the next 7 days. Click REFRESH to check again.
                    </p>
                    <button
                      onClick={fetchRmBarcaFromSheets}
                      className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-2xl font-black text-sm transition-all"
                    >
                      FETCH LIVE DATA
                    </button>
                  </div>
                ) : (
                  <div className="grid gap-8">
                    {rmBarcaMatches.map(match => (
                      <div key={match.id} className={`bg-slate-900 border-2 rounded-2xl p-6 ${
                        match.isElClasico ? 'border-red-500 ring-2 ring-red-500/30' : 'border-blue-500/50'
                      }`}>
                        {match.isElClasico && (
                          <div className="bg-red-500 text-white text-xs font-black px-3 py-1 rounded-full w-fit mb-3 uppercase">
                            ‚öΩ EL CL√ÅSICO
                          </div>
                        )}
                        
                        <h4 className="text-lg font-bold text-white mb-4">{match.event}</h4>
                        
                        <div className="flex items-center justify-center gap-4 mb-4">
                          <div className="text-center">
                            <p className="text-xs text-slate-500 mb-1 uppercase">Home</p>
                            <p className="text-sm font-bold text-blue-400">{match.home_team.split(' ').slice(-1)[0]}</p>
                          </div>
                          
                          <div className="text-center bg-gradient-to-r from-emerald-500/20 to-blue-500/20 border-2 border-emerald-500/50 rounded-xl px-6 py-3">
                            <p className="text-xs text-emerald-400 font-black uppercase mb-1">AI Predicted Score</p>
                            <p className="text-4xl font-black text-white">{match.predictedScore || '?-?'}</p>
                          </div>
                          
                          <div className="text-center">
                            <p className="text-xs text-slate-500 mb-1 uppercase">Away</p>
                            <p className="text-sm font-bold text-amber-400">{match.away_team.split(' ').slice(-1)[0]}</p>
                          </div>
                        </div>
                        
                        <div className="flex items-center justify-between pt-4 border-t border-slate-800">
                          <div>
                            <p className="text-xs text-slate-500 uppercase mb-1">Confidence</p>
                            <p className="text-2xl font-black text-emerald-400">{match.scoreConfidence || 0}%</p>
                          </div>
                          <div className="text-right">
                            <p className="text-xs text-slate-500 uppercase mb-1">Kick-off</p>
                            <p className="text-sm font-bold text-white">
                              {new Date(match.commence_time).toLocaleDateString()} {new Date(match.commence_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </p>
                          </div>
                        </div>
                        
                        {match.reasoning && (
                          <p className="text-xs text-slate-400 italic mt-3">
                            {match.reasoning}
                          </p>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* ============================================================ */}
            {/* PROVISIONING TAB */}
            {/* ============================================================ */}
            {activeTab === 'provisioning' && (
              <div className="animate-in fade-in duration-700">
                <header className="mb-8">
                  <h2 className="text-3xl font-black text-white tracking-tight mb-2">System Provisioning</h2>
                  <p className="text-slate-500 font-medium">Configure your ABIS intelligence system</p>
                </header>

                <div className="bg-slate-900 border-2 border-emerald-500/50 rounded-3xl p-8">
                  <div className="flex items-start gap-4 mb-6">
                    <div className="bg-emerald-500 p-3 rounded-xl">
                      <Database size={24} className="text-white" />
                    </div>
                    <div className="flex-1">
                      <h3 className="text-xl font-black text-white mb-2">‚úÖ System Connected</h3>
                      <p className="text-slate-400 text-sm mb-4">
                        Your Google Apps Script is deployed and ready to fetch live data from:
                      </p>
                      <ul className="text-sm text-slate-400 space-y-2 mb-4">
                        <li>‚Ä¢ <span className="text-emerald-400 font-bold">The Odds API</span> - Live odds and match data</li>
                        <li>‚Ä¢ <span className="text-emerald-400 font-bold">Gemini AI</span> - Score predictions and analysis</li>
                        <li>‚Ä¢ <span className="text-emerald-400 font-bold">Google Sheets</span> - Data storage and sync</li>
                      </ul>
                      <div className="bg-slate-950 border border-slate-800 rounded-xl p-4 font-mono text-xs text-slate-400 break-all">
                        {API_CONFIG.WEBAPP_URL}
                      </div>
                    </div>
                  </div>

                  <div className="bg-blue-500/20 border-2 border-blue-500/50 rounded-xl p-4">
                    <p className="text-sm text-blue-300 font-bold">
                      üí° <strong>Pro Tip:</strong> The system automatically fetches fresh data when you switch tabs. 
                      Click REFRESH on any tab to get the latest live predictions!
                    </p>
                  </div>
                </div>

                <div className="mt-8 bg-slate-900 border-2 border-slate-800 rounded-3xl p-8">
                  <h3 className="text-xl font-black text-white mb-4">üìä API Status</h3>
                  <div className="grid gap-4">
                    <div className="flex items-center justify-between bg-slate-950 p-4 rounded-xl">
                      <span className="text-sm font-bold text-slate-300">The Odds API</span>
                      <span className="bg-emerald-500 text-white text-xs font-black px-3 py-1 rounded-full">ACTIVE</span>
                    </div>
                    <div className="flex items-center justify-between bg-slate-950 p-4 rounded-xl">
                      <span className="text-sm font-bold text-slate-300">Gemini AI</span>
                      <span className="bg-emerald-500 text-white text-xs font-black px-3 py-1 rounded-full">ACTIVE</span>
                    </div>
                    <div className="flex items-center justify-between bg-slate-950 p-4 rounded-xl">
                      <span className="text-sm font-bold text-slate-300">Google Sheets</span>
                      <span className={`text-white text-xs font-black px-3 py-1 rounded-full ${
                        isConnected ? 'bg-emerald-500' : 'bg-slate-700'
                      }`}>
                        {isConnected ? 'CONNECTED' : 'CHECKING...'}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
